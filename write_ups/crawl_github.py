#!/usr/bin/python
from bs4 import BeautifulSoup
import requests
import os

r = requests.get('https://github.com/ctfs/write-ups')
soup = BeautifulSoup(r.text)
#li = soup.select('.js-directory-link')
os.mkdir('/root/writeups/')

li_reg = soup.select('a[href^="/ctfs/write-ups/tree/master/"]')#list of tags

for i in range(0,len(li_reg)):
    link = li_reg[i]['href']
    print '*'*20
    print '[',i+1,']', li_reg[i]['title'], link
    print '-'*10

    #challenges
    b = requests.get('https://github.com'+ link)
    soup2 = BeautifulSoup(b.text)
    li_reg2 = soup2.select('a[href^="/ctfs/write-ups/tree/master/"]')

    for j in range(1,len(li_reg2)):
	challenge_writeup_link = li_reg2[j]['href']
	print '[',j,']', challenge_writeup_link
	
	writeup_link = 'https://raw.githubusercontent.com'+ challenge_writeup_link.replace('/tree','') +'/README.md'
	print writeup_link
	c = requests.get(writeup_link)
	if c.status_code == 200:
	    res = c.content
	    #print res    
	    try:
		file_name = res[res.index(':')+2:res.index('**')-2]
	    	category = res[res.find('Category')+12:res.find('**Points')-1]
	    	points = res[res.find('Points')+10:res.find('**Description')-1]
	    except:
		file_name = res[res.index(':')+1:res.index('##')-2]
		category = 'Other'
		points = '0'

	    print file_name, category, points
	    try:
	    	os.mkdir('/root/writeups/'+category)
	    except:
		None
	
	    f = open('/root/writeups/'+category+'/'+file_name+'.txt', 'w')
	    f.write(res)
	    f.close()
